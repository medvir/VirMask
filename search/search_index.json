{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome to VirMask","text":"<p>VirMask is a novel computational tool created to systematically mask non-viral  elements (e.g., human, rRNA sequences and other artifacts) within viral reference  databases, as well as virus-derived sequences that are recurrently detected in  mNGS samples, likely introduced during sample preparation or sequencing workflows.</p> <p>The ultimate goal of the tool is to improve reliability of viral mNGS diagnosis.</p> <p>To see and download the code, visit our GitHub. Information on how to install the tool can be found in the <code>Installation</code> section.</p> <p>VirMask consists of two main parts:</p> <ul> <li> <p><code>Human masking</code>: detects and masks viral refrence  genomes that contain human sequences.</p> </li> <li> <p><code>Contaminants masking</code>: identifies and masks  recurrent contaminants within the viral database, such as rRNA seqences, vector  contamination and sequencing adapters present in the viral database.</p> </li> </ul> <p>Users can run each of these two functions individually if only human sequences or  recurrent contaminants need to be removed, or alternatively (and highly recommended),  they can run VirMask as a whole:</p> <ul> <li><code>VirMask</code>: spots and masks human sequences and  recurrent contaminants from the viral database.</li> </ul> <p>Some help can be obtained with <code>VirMask.sh -h</code>.</p> <p>Enjoy using VirMask!</p> <p></p>"},{"location":"Human_contaminants/","title":"Remove Human Contaminants","text":"<p>Very often, viral reference databases (e.g., viral genomes downloaded from the NCBI RefSeq  database) may contain non-viral contaminants, in particular host human DNA. As a first step, we recommend masking all these human contaminants to dramatically reduce the number of spurious alignments and false positives.</p> <p>Even though there are multiple software available for that, we also implemented this option into VirMask, aiming to provide users with an end-to-end tool for the masking process.</p> <p>In order to use the Human Masking option alone (instead of  <code>VirMask</code> as a whole) users need to run:</p> <p><code>Human_masking.py [options]</code></p> <p>Information on the input parameters can be obtained with the <code>-h</code> flag:</p> <pre><code>usage: Human_masking.py [-h] [--virmet_db VIRMET_DB] [--threads THREADS]\n\nDetection and masking of human sequences within the viral database.\n\nOptions:\n  -h, --help            show this help message and exit\n  --virmet_db VIRMET_DB\n                        Path to the VirMet database (default: /data/virmet_databases_update/)\n  --threads THREADS     Number of threads to use (default: 24)\n</code></pre> <p>Please, note that the outputs will be stored at the working directory and will contain multiple intermediate files. Therefore, it is highly recommended to create an output folder first and set it as the current working directory:</p> <pre><code>mkdir human_masking_outputs\ncd human_masking_outputs\nHuman_masking.py\n</code></pre> <p>Users who use <code>VirMask</code> pipeline don't need to worry about that.  VirMask already offers the possibility to specify an output folder and creates a subfolder there to store the outputs.</p>"},{"location":"Human_contaminants/#outputs","title":"Outputs","text":"<p>Running the previous command should provide several outputs, some of which are intermediate files. The most important results are:</p> <ul> <li>Viral_db_masked.fasta: viral database with masked human sequences.</li> <li>Chrs_mapped_ref_newDB.csv: summary table of the masked human-associated viral sequences.</li> </ul> <p>The other intermediate files are there for inspection only and can be removed by the users at any time. They show the viral sequences that matched each of the human chromosomes (including chromosomes 1 to 22, X, Y, M).</p> <p>Enjoy removing Human Sequences!</p>"},{"location":"Installation/","title":"Installing VirMask","text":"<p>VirMask code can be downloaded from our GitHub as follows:</p> <p><code>git clone https://github.com/medvir/VirMask.git $HOME/VirMask</code></p> <p>After downloading the code, we highly advise to add VirMask into your <code>$PATH</code> in order to be able to call it easily from any folder:</p> <pre><code># Add VirMask to your PATH\necho \"export PATH=$HOME/VirMask:$PATH\" &gt;&gt; $HOME/.bashrc\necho \"export PATH=$HOME/VirMask/Human_contaminants:$PATH\" &gt;&gt; $HOME/.bashrc\necho \"export PATH=$HOME/VirMask/Recurrent_contaminants:$PATH\" &gt;&gt; $HOME/.bashrc\nsource $HOME/.bashrc\n</code></pre> <p>The tool is designed for a Linux environment with several software  and dependencies installed and accessible in your <code>$PATH</code>. See information below.</p>"},{"location":"Installation/#human-masking","title":"Human Masking","text":"<p>To run the <code>Human masking</code> function, users will need:</p> <ul> <li> <p>Python 3.8 or newer \u2014 fully tested with Python 3.12.</p> </li> <li> <p>Snakemake (\u22657.0) \u2014 fully tested with Snakemake 7.32.4.</p> </li> <li> <p>samtools (\u22651.10) \u2014 fully tested with samtools 1.21.</p> </li> <li> <p>bedtools (\u22652.30) \u2014 fully tested with bedtools v2.31.1.</p> </li> <li> <p>bwa (\u22650.7.17) \u2014 fully tested with bwa 0.7.19-r1273</p> </li> <li> <p>art_illumina \u2014 fully tested with version 2.5.8.</p> </li> <li> <p>awk, grep, sort, uniq, gzip (standard UNIX tools, usually preinstalled).</p> </li> </ul> <p>Make sure all these tools can be called from the command line before running the scripts.</p> <p>In addition, install the required Python packages using <code>pip</code>:</p> <p><code>pip install pandas</code></p> <p>With that, you are ready to start the human masking!</p>"},{"location":"Installation/#contaminants-masking","title":"Contaminants Masking","text":"<p>To run the <code>Contaminants masking</code> function, users will need:</p> <ul> <li> <p>Python 3.8 or newer \u2014 fully tested with Python 3.12.</p> </li> <li> <p>blastn (BLAST+ \u22652.12.0) \u2014 fully tested with version 2.16.0+.</p> </li> <li> <p>VirMet 2.0 \u2014 fully tested with VirMet 2.0.0.</p> </li> <li> <p>awk, grep, sort, uniq, gzip (standard UNIX tools, usually preinstalled).</p> </li> </ul> <p>Make sure all these tools can be called from the command line before running the scripts.</p> <p>In addition, install the required Python packages using <code>pip</code>:</p> <pre><code>pip install pandas # if not done before\npip install biopython\n</code></pre> <p>With that, you are ready to start the masking of recurrent contaminants!</p>"},{"location":"Installation/#masking-all-together-virmask","title":"Masking All Together: VirMask","text":"<p>To run <code>VirMask</code>, including both human masking and recurrent contaminants masking, users will need to have all software and dependencies listed above for each of the two steps.</p>"},{"location":"Installation/#database","title":"Database","text":"<p>To run <code>VirMask</code>, the tool expects users to have, at least, a human database and a viral database (only for the  <code>Human masking</code>).</p> <p>If they are also planning to use the <code>Contaminants masking</code>, they will need the whole <code>VirMet</code> database, which can be downloaded as follows:</p> <p><pre><code>virmet fetch --viral n\nvirmet fetch --human\nvirmet fetch --bact_fungal\nvirmet fetch --bovine\n</code></pre> To make the VirMet database fully functional, they will also need to index it.</p> <p><code>virmet index --viral n --human --bact_fungal --bovine</code></p> <p>In either case, the database directory should have the following structure:</p> <p><pre><code># Database needed for the Human Masking only:\nvirmet_databases_update/\n\u251c\u2500\u2500 viral_nuccore/\n\u2502   \u2514\u2500\u2500 viral_database.fasta\n\u2514\u2500\u2500 human/\n    \u2514\u2500\u2500 fasta/\n        \u2514\u2500\u2500 GRCh38.fasta.gz\n\n# Database needed for the Recurrent Contaminats Masking:\nvirmet_databases_update/\n\u251c\u2500\u2500 viral_nuccore/\n\u2502   \u251c\u2500\u2500 viral_database.fasta\n\u2502   \u251c\u2500\u2500 viral_accn_taxid.dmp\n\u2502   \u2514\u2500\u2500 viral_seqs_info.tsv\n\u251c\u2500\u2500 human/\n\u2502   \u251c\u2500\u2500 fasta/\n\u2502   \u2502   \u2514\u2500\u2500 GRCh38.fasta.gz\n\u2502   \u2514\u2500\u2500 bwa/\n\u2502       \u2514\u2500\u2500 bwa_files\n\u251c\u2500\u2500 bovine/\n\u2502   \u251c\u2500\u2500 fasta/\n\u2502   \u2502   \u2514\u2500\u2500 ref_Bos_taurus.fasta.gz\n\u2502   \u2514\u2500\u2500 bwa/\n\u2502       \u2514\u2500\u2500 bwa_files\n\u251c\u2500\u2500 bact_fungi/\n\u2502   \u251c\u2500\u2500 library/\n\u2502   \u2502   \u251c\u2500\u2500 bacteria\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 library.fna\n\u2502   \u2502   \u2514\u2500\u2500 fungi\n\u2502   \u2502       \u2514\u2500\u2500 library.fna\n\u2502   \u2514\u2500\u2500 taxonomy/\n\u2502       \u2514\u2500\u2500 taxdump.tar.gz\n\u251c\u2500\u2500 names.dmp.gz\n\u2514\u2500\u2500 nodes.dmp.gz\n</code></pre> Please, note that the name of the database doesn't need to be necessarily <code>virmet_databases_update</code>. However, this is the default name taken by <code>VirMask</code> if not specified otherwise.</p> <p>Enjoy using VirMask!</p>"},{"location":"Recurrent_contaminants/","title":"Remove Recurrent Contaminants","text":"<p>In viral mNGS diagnosis, a common challenge is the frequent classification of sequences as viral that appear across unrelated samples. These spurious hits often arise from non-viral elements such as rRNA, vector contamination and sequencing adapters within the viral database, along with viral-derived sequences likely introduced into the mNGS samples during sample preparation (e.g., CMV enhancers).</p> <p>To improve diagnostic specificity and reduce false-positive identifications, we recommend to systematically mask these recurrent contaminants. This is the main goal of the Contaminants Masking step implemented into <code>VirMask</code>.</p> <p>In order to use the Contaminants Masking option alone (instead of  <code>VirMask</code> as a whole) users need to run:</p> <p><code>Recurrent_masking.py --mNGS_runs &lt;mNGS_to_analyse.txt&gt; [options]</code></p> <p>Information on the input parameters can be obtained with the <code>-h</code> flag:</p> <pre><code>usage: Recurrent_masking.py [-h] --mNGS_runs MNGS_RUNS [options]\n\nDetection and masking of recurrent contaminants within the viral database.\n\nOptions:\n  -h, --help             show this help message and exit\n  --mNGS_runs MNGS_RUNS\n                         Path to a .txt file listing all mNGS runs to consider (one run per row)\n  --virmet_db VIRMET_DB\n                         Path to the VirMet database (default: /data/virmet_databases_update/)\n  --across_sample_freq   ACROSS_SAMPLE_FREQ\n                         Across-sample frequency threshold (default: 0.2 = 20%)\n  --within_acc_dominance WITHIN_ACC_DOMINANCE\n                         Within-accession dominance threshold (default: 0.2 = 20%)\n  --min_fragment_size    MIN_FRAGMENT_SIZE\n                         Minimum size of the fragment to be masked (default: 21 bp)\n  --max_fragment_size    MAX_FRAGMENT_SIZE\n                         Maximum size of the fragment to be masked (default: 499 bp)\n  --max_genome_perc      MAX_GENOME_PERC\n                         Maximum percentage of genome to mask (default: 0.05 = 5%)\n  --controls CONTROLS    Pattern to identify viruses that should be prevented from masking. \n                         If more than one is provided, add them within quotes and separated by commas.\n                         Example: 'Tunavirus T1, phage MS2'.\n                         This avoids masking your internal controls, which appear in all samples.\n  --threads THREADS      Number of threads to use (default: 24)\n</code></pre> <p>Please, note that the outputs will be stored at the working directory. Therefore, it is highly recommended to create an output folder first and set it as the current working directory:</p> <pre><code>mkdir contaminants_masking_outputs\ncd contaminants_masking_outputs\nRecurrent_masking.py --mNGS_runs mNGS_to_analyse.txt\n</code></pre> <p>Users who use <code>VirMask</code> pipeline don't need to worry about that.  VirMask already offers the possibility to specify an output folder and creates a subfolder there to store the outputs.</p>"},{"location":"Recurrent_contaminants/#outputs","title":"Outputs","text":"<p>Running the previous command should provide the following output files:</p> <ul> <li>Recurrent_contaminant_regions.tsv: recurrent contaminants identified in the samples.</li> <li>Sequence_similarity_search.tsv: homologous regions that were ultimately masked.</li> <li>Masked_viral_database.fasta: the masked viral reference database (FASTA file).</li> <li>Homologous_regions_masked.fasta: the extracted masked fragments used for validation.</li> </ul> <p>Enjoy removing Recurrent Contaminants!</p>"},{"location":"Virmask/","title":"Remove Human Sequences and Recurrent Contaminants","text":"<p>VirMask has been developed as a novel computational strategy to improve the specificity  of viral mNGS diagnosis by masking problematic regions within viral reference databases.</p> <p>Upon masking human sequences (likely attributable to the viral hosts), our approach mines  prior mNGS runs to identify sequences that appear frequently across a high proportion  of samples or that dominate the read counts for particular strains, suggesting they may arise from technical artifacts or non-viral sources rather than genuine infections. These sequences are then subjected to alignment-based similarity searches to identify homologous regions in the reference database, which are subsequently masked as well.</p> <p>VirMask's targeted masking reduces the likelihood that reads derived from non-specific or contamination-prone regions will spuriously align to viral genomes.</p> <p>In order to use VirMask, users need to run:</p> <p><code>VirMask.sh -r &lt;mNGS_runs&gt; [options]</code></p> <p>Information on the input parameters can be obtained with the <code>-h</code> flag:</p> <pre><code>Usage: \nVirMask.sh -r &lt;mNGS_runs&gt; [options]\nOptions:\n        [-h or --help]\n        [-d or --virmet_db]\n        [-s or --across_sample_freq]\n        [-a or --within_acc_dominance]\n        [-l or --min_fragment_size]\n        [-u or --max_fragment_size]\n        [-g or --max_genome_perc]\n        [-c or --controls]\n        [-o or --output]\n        [-t or --threads]\n\nOptions:\n        -h, --help:\n                Show this help message and exit.\n        -d, --virmet_db:\n                Path to the VirMet database.\n                Default: /data/virmet_databases_update/\n        -s, --across_sample_freq:\n                Across-sample frequency threshold.\n                Default: 0.2 (20%)\n        -a, --within_acc_dominance\n                With-accesion dominance threshold.\n                Default: 0.2 (20%)\n        -l, --min_fragment_size:\n                Minimum size (bp) of the fragment to be masked.\n                Default: 21\n        -u, --max_fragment_size:\n                Maximum size (bp) of the fragment to be masked.\n                Default: 499\n        -g, --max_genome_perc:\n                Maximum percentage of genome to mask.\n                Default: 0.05 (5%)\n        -c, --controls:\n                Pattern to identify viruses that should be prevented from masking.\n                If more than one is provided, add them within quotes and separated by commas.\n                This avoids masking your internal controls, which appear in all samples.\n                Default: 'Tunavirus T1, phage MS2'\n        -o, --output:\n                Path to the location where the outputs should be stored.\n                Default: current folder, which is ./\n        -t, --threads:\n                Number of threads to use.\n                Default: 24\nRequired arguments:\n        -r, --mNGS_runs:\n                Path to a text file (.txt) listing all mNGS runs to consider (one run per row).\n</code></pre> <p>Please, note that a subfolder will be created in the specified output directory, and all the outputs will be stored there. If no output directory is provided, the current working directory will be considered.</p>"},{"location":"Virmask/#outputs","title":"Outputs","text":"<p>Running the previous command should provide the following output files:</p> <ul> <li>Viral_db_masked.fasta: viral database with masked human sequences only.</li> <li>Chrs_mapped_ref_newDB.csv: summary table of the masked human-associated viral sequences.</li> <li>Recurrent_contaminant_regions.tsv: recurrent contaminants identified in the samples.</li> <li>Sequence_similarity_search.tsv: homologous regions that were ultimately masked.</li> <li>Masked_viral_database.fasta: the fully masked viral reference database (FASTA file).</li> <li>Homologous_regions_masked.fasta: the extracted masked fragments used for validation.</li> </ul> <p>Besides these important files, VirMask will also create several other intermediate files are there for inspection only and can be removed by the users at any time.</p> <p>Enjoy removing contaminants with VirMask!</p> <p></p>"}]}